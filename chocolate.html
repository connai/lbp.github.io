<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>巧克力日常记录 | marklbp blog</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="plugins/fonts/awesome/css/awesome.css">
    <link rel="stylesheet" type="text/css" href="plugins/bootstrap/3.3.5/css/bootstrap.min.css">
    <style type="text/css">
    	html,body,.box{
    		height: 100%;
    	}
    	.box{
    		display: -webkit-box;
    		display: -moz-box;
    		display: -o-box;
			display: box;
			-webkit-box-orient: vertical;
			-moz-box-orient: vertical;
			-o-box-orient: vertical;
			box-orient: vertical;
			overflow: hidden;
			text-align: center;
    	}
    	.row-auto{
    		margin-right: 0;
    		margin-left: 0;
    	}
		.header,.footer{
			height: 50px;
			line-height: 50px;
		    background-color: #000;
    		color: #fff;
    		font-size: large;
		}
		.mid{
			-webkit-box-flex: 1;
			overflow: auto;
		}
		.header{
			top: 0;
			font-weight: bold;
		}
		.footer{
			bottom: 0;
		}
    	.record{
    		border: 1px solid #000;
    		border-left: 0;
    		border-right: 0;
    		color: green;
    		line-height: 30px;
    		overflow: hidden;
    	}
    	.record .count{
    		color: red;
    	}
    	.record .col-xs-4{
    		height: 30px;
    	}
    	.record~.record{
    		border-top: 0;
    	}
    	.record .row{
    		border-top: 1px solid #000;
    	}
    	.record .row:nth-of-type(1){
    		border-top: 0;
    	}
    	.record .col-xs-10{
    		border-left: 1px solid #000;
    	}
    	.record .col-xs-4:nth-of-type(2){
    		border-left: 1px solid #000;
    		border-right: 1px solid #000;
    	}
    </style>
</head>
<body>
	<div class="box">
		<div class="row header row-auto">
			<div class="col-xs-2">日期</div>
			<div class="col-xs-10">
				<div class="row">
					<div class="col-xs-4">小</div>
					<div class="col-xs-4">大</div>
					<div class="col-xs-4">时间</div>
				</div>
			</div>
		</div>
		<div class="mid">
			<div id="records"></div>
		</div>
		<div class="row row-auto footer">
			<label class="col-xs-4 text-right"><input type="checkbox" id="linput" name="l">小</label>
			<label class="col-xs-4"><input type="checkbox" id="binput" name="b">大</label>
			<label class="col-xs-4 text-left"><button class="btn btn-success" onclick="setRecord()">提交</button></label>
		</div>
	</div>	
    <script type="text/javascript" src="plugins/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="plugins/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/marklbp.js"></script>
    <script type="text/javascript">
    	var records = localStorage.getItem("records") == "undefined" ? [
            {
                d: "1.29",
                r: [
                    {l: 1, b: 0, t: "08:00"}
                    ,{l: 1, b: 0, t: "09:30"}
                    ,{l: 1, b: 0, t: "11:30"}
                    ,{l: 1, b: 0, t: "14:05"}
                    ,{l: 1, b: 0, t: "16:20"}
                    ,{l: 1, b: 0, t: "16:50"}
                    ,{l: 1, b: 0, t: "19:30"}
                    ,{l: 1, b: 0, t: "22:40"}
                ]
            }
            ,{
                d: "1.30",
                r: [
                    {l: 1, b: 0, t: "02:00"}
                    ,{l: 1, b: 0, t: "05:30"}
                    ,{l: 1, b: 0, t: "09:00"}
                    ,{l: 1, b: 0, t: "13:00"}
                    ,{l: 1, b: 0, t: "15:30"}
                    ,{l: 1, b: 0, t: "17:00"}
                    ,{l: 1, b: 1, t: "18:51"}
                    ,{l: 1, b: 0, t: "20:00"}
                    ,{l: 1, b: 0, t: "20:05"}
                    ,{l: 1, b: 1, t: "20:50"}
                    ,{l: 1, b: 1, t: "22:15"}
                    ,{l: 1, b: 1, t: "22:45"}
                    ,{l: 0, b: 1, t: "23:05"}
                ]
            }
            ,{
                d: "1.31",
                r: [
                    {l: 1, b: 0, t: "01:20"}
                    ,{l: 1, b: 0, t: "03:30"}
                    ,{l: 1, b: 1, t: "10:20"}
                    ,{l: 0, b: 1, t: "12:05"}
                    ,{l: 0, b: 1, t: "14:30"}
                    ,{l: 0, b: 1, t: "15:00"}
                    ,{l: 0, b: 1, t: "15:30"}
                    ,{l: 1, b: 1, t: "16:00"}
                    ,{l: 1, b: 0, t: "17:18"}
                    ,{l: 1, b: 1, t: "20:30"}
                    ,{l: 1, b: 0, t: "21:20"}
                ]
            }
            ,{
                d: "2.1",
                r: [
                    {l: 1, b: 1, t: "03:00"}
                    ,{l: 1, b: 1, t: "09:00"}
                    ,{l: 1, b: 1, t: "13:00"}
                    ,{l: 0, b: 1, t: "13:21"}
                    ,{l: 1, b: 1, t: "14:30"}
                    ,{l: 1, b: 1, t: "17:00"}
                    ,{l: 1, b: 1, t: "19:00"}
                    ,{l: 0, b: 1, t: "19:20"}
                    ,{l: 1, b: 1, t: "22:20"}
                    ,{l: 1, b: 1, t: "22:30"}
                    ,{l: 1, b: 0, t: "21:20"}
                ]
            }
            ,{
                d: "2.2",
                r: [
                    {l: 1, b: 0, t: "00:30"}
                    ,{l: 0, b: 1, t: "00:50"}
                    ,{l: 1, b: 0, t: "03:30"}
                    ,{l: 1, b: 0, t: "04:00"}
                    ,{l: 1, b: 1, t: "06:45"}
                    ,{l: 1, b: 1, t: "10:00"}
                    ,{l: 0, b: 1, t: "13:30"}
                ]
            }
        ] : JSON.parse(localStorage.getItem("records")) ;

    	var html = "", i = 0, j = 0, r, z, l = 0, b = 0;
    	function setRecord() {
    		var recordss = localStorage.getItem("records") == "undefined" ? records : JSON.parse(localStorage.getItem("records"));
    		var last = recordss[recordss.length - 1];
    		var date = new Date();
    		var d = (date.getMonth() + 1) + '.' + date.getDate();
    		var h = date.getHours();
    		var m = date.getMinutes();
    		var t = (h > 9 ? h : ('0' + h)) + ':' + (m > 9 ? m : ('0' + m));
    		if(last && last.d == d){
    			last.r.push({
    				l: $("#linput").prop("checked") ? 1 : 0
    				,b: $("#binput").prop("checked") ? 1: 0
    				,t: t
    			})
    		}else{
    			recordss.push({
    				d: d,
    				r: [
    					{
		    				l: $("#linput").prop("checked") ? 1 : 0
		    				,b: $("#binput").prop("checked") ? 1: 0
		    				,t: t
		    			}
    				]
    			})
    		}
    		localStorage.setItem("records",JSON.stringify(recordss));
    		window.location.reload();
    	}
    	for(; i < records.length; i++){
    		r = records[i];
    		l = 0; 
    		b = 0;
    		html += '<div class="row record row-auto">\
						<div class="col-xs-2">'+ r.d +'</div>\
						<div class="col-xs-10">';
				for (j = 0; j < r.r.length; j++) {
					z = r.r[j];
					l += z.l;
					b += z.b;
					html += '<div class="row">\
								<div class="col-xs-4">'+ (z.l == 0 ? "" : "&check;" ) +'</div>\
								<div class="col-xs-4">'+ (z.b == 0 ? "" : "&check;" ) +'</div>\
								<div class="col-xs-4">'+ z.t +'</div>\
							</div>'
				}			

			html +=		'   <div class="row count">\
								<div class="col-xs-4">'+ l +'次</div>\
								<div class="col-xs-4">'+ b +'次</div>\
								<div class="col-xs-4"></div>\
							</div>\
						</div>\
						<div class="col-xs-12"></div>\
					</div>';
    	}
    	var h = $("#records").append(html).height();
    	var h1 = $("#records").parent().height();
    	$("#records").parent().scrollTop( h - h1);    	
    </script>
</body>
</html>